<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Apache Flink 1.8-SNAPSHOT Documentation: Custom Serialization for Managed State</title>
    <link rel="shortcut icon" href="/page/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/page/favicon.ico" type="image/x-icon">
    <link rel="canonical" href="//ci.apache.org/projects/flink/flink-docs-stable/dev/stream/state/custom_serialization.html">

    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
    <link rel="stylesheet" href="/page/css/flink.css">
    <link rel="stylesheet" href="/page/css/syntax.css">
    <link rel="stylesheet" href="/page/css/codetabs.css">
    <link rel="stylesheet" href="/page/font-awesome/css/font-awesome.min.css">
    
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>
    

    <!-- Main content. -->
    <div class="container">
      
      <div class="row">
        <div class="col-lg-3" id="sidenavcol">
          







  
    
    
    
      
    
  

  
    
    
    
      
    
  

  
    
    
    
      
    
  

  
    
    
    
      













<div class="sidenav-logo">
  <p><a href=""><img class="bottom" alt="Apache Flink" src="/page/img/navbar-brand-logo.jpg"></a> v1.8-SNAPSHOT</p>
</div>
<ul id="sidenav">

  
    

    

    
    
    

    

    
    
<li><a href="/"><i class="fa fa-home title" aria-hidden="true"></i> Home</a></li>
    
  

  
    

    

    
    
    

    <hr class="section-break"></hr>

    
    
      
      
        
        
<li><a href="#collapse-2" data-toggle="collapse"><i class="fa fa-map-o title appetizer" aria-hidden="true"></i> Concepts <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-2"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
      
      
<li><a href="/concepts/programming-model.html">Programming Model</a></li>
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/concepts/runtime.html">Distributed Runtime</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-6" data-toggle="collapse"><i class="fa fa-power-off title appetizer" aria-hidden="true"></i> Tutorials <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-6"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-7" data-toggle="collapse">API Tutorials <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-7"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/tutorials/datastream_api.html">DataStream API</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-10" data-toggle="collapse">Setup Tutorials <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-10"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/tutorials/local_setup.html">Local Setup</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/tutorials/flink_on_windows.html">Running Flink on Windows</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-15" data-toggle="collapse"><i class="fa fa-file-code-o title appetizer" aria-hidden="true"></i> Examples <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-15"><ul>
  <li><a href="/examples/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/batch/examples.html">Batch Examples</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    <hr class="section-break"></hr>

    
    
      
      
        
        
<li><a href="#collapse-18" data-toggle="collapse" class="active"><i class="fa fa-code title maindish" aria-hidden="true"></i> Application Development</a><div class="collapse in" id="collapse-18"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-19" data-toggle="collapse">Project Build Setup <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-19"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/projectsetup/java_api_quickstart.html">Project Template for Java</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/projectsetup/scala_api_quickstart.html">Project Template for Scala</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/projectsetup/dependencies.html">Configuring Dependencies, Connectors, Libraries</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-24" data-toggle="collapse">Basic API Concepts <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-24"><ul>
  <li><a href="/dev/api_concepts.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/scala_api_extensions.html">Scala API Extensions</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/java_lambdas.html">Java Lambda Expressions</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-28" data-toggle="collapse" class="active">Streaming (DataStream API)</a><div class="collapse in" id="collapse-28"><ul>
  <li><a href="/dev/datastream_api.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-29" data-toggle="collapse">Event Time <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-29"><ul>
  <li><a href="/dev/event_time.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/event_timestamps_watermarks.html">Generating Timestamps / Watermarks</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/event_timestamp_extractors.html">Pre-defined Timestamp Extractors / Watermark Emitters</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-33" data-toggle="collapse" class="active">State & Fault Tolerance</a><div class="collapse in" id="collapse-33"><ul>
  <li><a href="/dev/stream/state/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/stream/state/state.html">Working with State</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/stream/state/broadcast_state.html">The Broadcast State Pattern</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/stream/state/checkpointing.html">Checkpointing</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/stream/state/queryable_state.html">Queryable State</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/stream/state/state_backends.html">State Backends</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/stream/state/schema_evolution.html">State Schema Evolution</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/stream/state/custom_serialization.html" class="active">Custom State Serialization</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-42" data-toggle="collapse">Operators <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-42"><ul>
  <li><a href="/dev/stream/operators/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
      
      
<li><a href="/dev/stream/operators/windows.html">Windows</a></li>
      
    
  

  
    

    

    
    
    

    

    
    
      
      
<li><a href="/dev/stream/operators/joining.html">Joining</a></li>
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/stream/operators/process_function.html">Process Function</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/stream/operators/asyncio.html">Async I/O</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-48" data-toggle="collapse">Connectors <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-48"><ul>
  <li><a href="/dev/connectors/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/connectors/guarantees.html">Fault Tolerance Guarantees</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/connectors/kafka.html">Kafka</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/connectors/cassandra.html">Cassandra</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/connectors/kinesis.html">Kinesis</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/connectors/elasticsearch.html">Elasticsearch</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/connectors/filesystem_sink.html">Rolling File Sink</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/connectors/streamfile_sink.html">Streaming File Sink</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/connectors/rabbitmq.html">RabbitMQ</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/connectors/nifi.html">NiFi</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/connectors/twitter.html">Twitter</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/stream/side_output.html">Side Outputs</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/stream/python.html">Python API</a></li>
    
  

  
    

    

    
    
    

    

    
    
      
      
<li><a href="/dev/stream/testing.html">Testing</a></li>
      
    
  

  
    

    

    
    
    

    

    
    
      
      
<li><a href="/dev/stream/experimental.html">Experimental Features</a></li>
      
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-65" data-toggle="collapse">Batch (DataSet API) <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-65"><ul>
  <li><a href="/dev/batch/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/batch/dataset_transformations.html">Transformations</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/batch/fault_tolerance.html">Fault Tolerance</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/batch/zip_elements_guide.html">Zipping Elements</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/batch/iterations.html">Iterations</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/batch/python.html">Python API</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/batch/connectors.html">Connectors</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/batch/hadoop_compatibility.html">Hadoop Compatibility</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/local_execution.html">Local Execution</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/cluster_execution.html">Cluster Execution</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-76" data-toggle="collapse">Table API & SQL <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-76"><ul>
  <li><a href="/dev/table/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/table/common.html">Concepts & Common API</a></li>
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-78" data-toggle="collapse">Streaming Concepts <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-78"><ul>
  <li><a href="/dev/table/streaming/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/table/streaming/dynamic_tables.html">Dynamic Tables</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/table/streaming/time_attributes.html">Time Attributes</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/table/streaming/joins.html">Joins in Continuous Queries</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/table/streaming/temporal_tables.html">Temporal Tables</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/table/streaming/match_recognize.html">Detecting Patterns</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/table/streaming/query_configuration.html">Query Configuration</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/table/connect.html">Connect to External Systems</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/table/tableApi.html">Table API</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/table/sql.html">SQL</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/table/functions.html">Built-In Functions</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/table/sourceSinks.html">User-defined Sources & Sinks</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/table/udfs.html">User-defined Functions</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/table/sqlClient.html">SQL Client</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-94" data-toggle="collapse">Data Types & Serialization <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-94"><ul>
  <li><a href="/dev/types_serialization.html">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/custom_serializers.html">Custom Serializers</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-97" data-toggle="collapse">Managing Execution <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-97"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/execution_configuration.html">Execution Configuration</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/packaging.html">Program Packaging</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/parallel.html">Parallel Execution</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/execution_plans.html">Execution Plans</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/restart_strategies.html">Restart Strategies</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-104" data-toggle="collapse">Libraries <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-104"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/libs/cep.html">Event Processing (CEP)</a></li>
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-106" data-toggle="collapse">Graphs: Gelly <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-106"><ul>
  <li><a href="/dev/libs/gelly/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/libs/gelly/graph_api.html">Graph API</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/libs/gelly/iterative_graph_processing.html">Iterative Graph Processing</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/libs/gelly/library_methods.html">Library Methods</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/libs/gelly/graph_algorithms.html">Graph Algorithms</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/libs/gelly/graph_generators.html">Graph Generators</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/libs/gelly/bipartite_graph.html">Bipartite Graph</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-114" data-toggle="collapse">Machine Learning <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-114"><ul>
  <li><a href="/dev/libs/ml/">Overview</a></li>
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/libs/ml/quickstart.html">Quickstart</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/libs/ml/contribution_guide.html">How to Contribute</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/libs/ml/cross_validation.html">Cross Validation</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/libs/ml/distance_metrics.html">Distance Metrics</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/libs/ml/knn.html">k-Nearest Neighbors Join</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/libs/ml/min_max_scaler.html">MinMax Scaler</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/libs/ml/multiple_linear_regression.html">Multiple Linear Regression</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/libs/ml/pipelines.html">Pipelines</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/libs/ml/polynomial_features.html">Polynomial Features</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/libs/ml/sos.html">Stochastic Outlier Selection</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/libs/ml/standard_scaler.html">Standard Scaler</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/libs/ml/als.html">ALS</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/libs/ml/svm.html">SVM using CoCoA</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/best_practices.html">Best Practices</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/dev/migration.html">API Migration Guides</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-133" data-toggle="collapse"><i class="fa fa-sliders title maindish" aria-hidden="true"></i> Deployment & Operations <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-133"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-134" data-toggle="collapse">Clusters & Deployment <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-134"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/ops/deployment/cluster_setup.html">Standalone Cluster</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/ops/deployment/yarn_setup.html">YARN</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/ops/deployment/mesos.html">Mesos</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/ops/deployment/kubernetes.html">Kubernetes</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/ops/deployment/docker.html">Docker</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/ops/deployment/aws.html">AWS</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/ops/deployment/gce_setup.html">Google Compute Engine</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/ops/deployment/mapr_setup.html">MapR</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/ops/deployment/hadoop.html">Hadoop Integration</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/ops/deployment/oss.html">Aliyun OSS</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/ops/jobmanager_high_availability.html">High Availability (HA)</a></li>
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-147" data-toggle="collapse">State & Fault Tolerance <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-147"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/ops/state/checkpoints.html">Checkpoints</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/ops/state/savepoints.html">Savepoints</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/ops/state/state_backends.html">State Backends</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/ops/state/large_state_tuning.html">Tuning Checkpoints and Large State</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
<li><a href="/ops/config.html">Configuration</a></li>
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/ops/production_ready.html">Production Readiness Checklist</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/ops/cli.html">CLI</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/ops/scala_shell.html">Scala REPL</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/ops/security-kerberos.html">Kerberos</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/ops/security-ssl.html">SSL Setup</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/ops/filesystems.html">File Systems</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/ops/upgrading.html">Upgrading Applications and Flink Versions</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-162" data-toggle="collapse"><i class="fa fa-bug title maindish" aria-hidden="true"></i> Debugging & Monitoring <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-162"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/monitoring/metrics.html">Metrics</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/monitoring/logging.html">Logging</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/monitoring/historyserver.html">History Server</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/monitoring/checkpoint_monitoring.html">Monitoring Checkpointing</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/monitoring/back_pressure.html">Monitoring Back Pressure</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/monitoring/rest_api.html">Monitoring REST API</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/monitoring/debugging_event_time.html">Debugging Windows & Event Time</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/monitoring/debugging_classloading.html">Debugging Classloading</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/monitoring/application_profiling.html">Application Profiling</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    <hr class="section-break"></hr>

    
    
      
      
        
        
<li><a href="#collapse-173" data-toggle="collapse"><i class="fa fa-cogs title dessert" aria-hidden="true"></i> Flink Development <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-173"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/flinkDev/ide_setup.html">Importing Flink into an IDE</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/flinkDev/building.html">Building Flink from Source</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    

    

    
    
    

    

    
    
      
      
        
        
<li><a href="#collapse-177" data-toggle="collapse"><i class="fa fa-book title dessert" aria-hidden="true"></i> Internals <i class="fa fa-caret-down pull-right" aria-hidden="true" style="padding-top: 4px"></i></a><div class="collapse" id="collapse-177"><ul>
  
        
        
        

        
        
      
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/internals/components.html">Component Stack</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/internals/stream_checkpointing.html">Fault Tolerance for Data Streaming</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/internals/job_scheduling.html">Jobs and Scheduling</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/internals/task_lifecycle.html">Task Lifecycle</a></li>
    
  

  
    

    

    
    
    

    

    
    
<li><a href="/internals/filesystems.html">File Systems</a></li>
    
  

  
    
      
      
</li></ul></div>
      
      
    
  

  
    
      
  <li class="divider"></li>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-master/api/java"><i class="fa fa-external-link title" aria-hidden="true"></i> Javadocs</a></li>
  <li><a href="//ci.apache.org/projects/flink/flink-docs-master/api/scala/index.html#org.apache.flink.api.scala.package"><i class="fa fa-external-link title" aria-hidden="true"></i> Scaladocs</a></li>
  <li><a href="http://flink.apache.org"><i class="fa fa-external-link title" aria-hidden="true"></i> Project Page</a></li>
</ul>

<div class="sidenav-search-box">
  <form class="navbar-form" role="search" action="/search-results.html">
    <div class="form-group">
      <input type="text" class="form-control" size="16px" name="q" placeholder="Search">
    </div>
    <button type="submit" class="btn btn-default">Go</button>
  </form>
</div>

<div class="sidenav-versions">
  <div class="dropdown">
    <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">Pick Docs Version
    <span class="caret"></span></button>
    <ul class="dropdown-menu">
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.7">v1.7</a></li>
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.6">v1.6</a></li>
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.5">v1.5</a></li>
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.4">v1.4</a></li>
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.3">v1.3</a></li>
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.2">v1.2</a></li>
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.1">v1.1</a></li>
      
      <li><a href="http://ci.apache.org/projects/flink/flink-docs-release-1.0">v1.0</a></li>
      
    </ul>
  </div>
</div>

        </div>
        <div class="col-lg-9 content" id="contentcol">
          

          





  
  
    
    
      
    
  

  
  
    
    
      
    
  

  
  
    
    
      
    
  

  
  
    
    
      



<ol class="breadcrumb">

  
  
    <li><i class="fa fa-code title maindish" aria-hidden="true"></i> Application Development</li>
  

  
  
    <li><a href="/dev/datastream_api.html">Streaming (DataStream API)</a></li>
  

  
  
    <li><a href="/dev/stream/state/">State & Fault Tolerance</a></li>
  

  
  
    <li class="active">Custom State Serialization</li>
  

</ol>

<h1>Custom Serialization for Managed State</h1>




<ul id="markdown-toc">
  <li><a href="#using-custom-state-serializers" id="markdown-toc-using-custom-state-serializers">Using custom state serializers</a></li>
  <li><a href="#state-serializers-and-schema-evolution" id="markdown-toc-state-serializers-and-schema-evolution">State serializers and schema evolution</a>    <ul>
      <li><a href="#the-typeserializersnapshot-abstraction" id="markdown-toc-the-typeserializersnapshot-abstraction">The <code class="highlighter-rouge">TypeSerializerSnapshot</code> abstraction</a></li>
      <li><a href="#how-flink-interacts-with-the-typeserializer-and-typeserializersnapshot-abstractions" id="markdown-toc-how-flink-interacts-with-the-typeserializer-and-typeserializersnapshot-abstractions">How Flink interacts with the <code class="highlighter-rouge">TypeSerializer</code> and <code class="highlighter-rouge">TypeSerializerSnapshot</code> abstractions</a></li>
    </ul>
  </li>
  <li><a href="#implementation-notes-and-best-practices" id="markdown-toc-implementation-notes-and-best-practices">Implementation notes and best practices</a></li>
  <li><a href="#migrating-from-deprecated-serializer-snapshot-apis-before-flink-17" id="markdown-toc-migrating-from-deprecated-serializer-snapshot-apis-before-flink-17">Migrating from deprecated serializer snapshot APIs before Flink 1.7</a></li>
</ul>

<p>This page is targeted as a guideline for users who require the use of custom serialization for their state, covering
how to provide a custom state serializer as well as guidelines and best practices for implementing serializers that allow
state schema evolution.</p>

<p>If you’re simply using Flink’s own serializers, this page is irrelevant and can be ignored.</p>

<h2 id="using-custom-state-serializers">Using custom state serializers</h2>

<p>When registering a managed operator or keyed state, a <code class="highlighter-rouge">StateDescriptor</code> is required
to specify the state’s name, as well as information about the type of the state. The type information is used by Flink’s
<a href="../../types_serialization.html">type serialization framework</a> to create appropriate serializers for the state.</p>

<p>It is also possible to completely bypass this and let Flink use your own custom serializer to serialize managed states,
simply by directly instantiating the <code class="highlighter-rouge">StateDescriptor</code> with your own <code class="highlighter-rouge">TypeSerializer</code> implementation:</p>

<div class="codetabs">
  <div data-lang="java">

    <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomTypeSerializer</span> <span class="kd">extends</span> <span class="n">TypeSerializer</span><span class="o">&lt;</span><span class="n">Tuple2</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="o">{...};</span>

<span class="n">ListStateDescriptor</span><span class="o">&lt;</span><span class="n">Tuple2</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">descriptor</span> <span class="o">=</span>
    <span class="k">new</span> <span class="n">ListStateDescriptor</span><span class="o">&lt;&gt;(</span>
        <span class="s">"state-name"</span><span class="o">,</span>
        <span class="k">new</span> <span class="nf">CustomTypeSerializer</span><span class="o">());</span>

<span class="n">checkpointedState</span> <span class="o">=</span> <span class="n">getRuntimeContext</span><span class="o">().</span><span class="na">getListState</span><span class="o">(</span><span class="n">descriptor</span><span class="o">);</span></code></pre></figure>

  </div>

  <div data-lang="scala">

    <figure class="highlight"><pre><code class="language-scala" data-lang="scala"><span class="k">class</span> <span class="nc">CustomTypeSerializer</span> <span class="k">extends</span> <span class="nc">TypeSerializer</span><span class="o">[(</span><span class="kt">String</span>, <span class="kt">Integer</span><span class="o">)]</span> <span class="o">{...}</span>

<span class="k">val</span> <span class="n">descriptor</span> <span class="k">=</span> <span class="k">new</span> <span class="nc">ListStateDescriptor</span><span class="o">[(</span><span class="kt">String</span>, <span class="kt">Integer</span><span class="o">)](</span>
    <span class="s">"state-name"</span><span class="o">,</span>
    <span class="k">new</span> <span class="nc">CustomTypeSerializer</span><span class="o">)</span>
<span class="o">)</span>

<span class="n">checkpointedState</span> <span class="k">=</span> <span class="n">getRuntimeContext</span><span class="o">.</span><span class="n">getListState</span><span class="o">(</span><span class="n">descriptor</span><span class="o">)</span></code></pre></figure>

  </div>
</div>

<h2 id="state-serializers-and-schema-evolution">State serializers and schema evolution</h2>

<p>This section explains the user-facing abstractions related to state serialization and schema evolution, and necessary
internal details about how Flink interacts with these abstractions.</p>

<p>When restoring from savepoints, Flink allows changing the serializers used to read and write previously registered state,
so that users are not locked in to any specific serialization schema. When state is restored, a new serializer will be
registered for the state (i.e., the serializer that comes with the <code class="highlighter-rouge">StateDescriptor</code> used to access the state in the
restored job). This new serializer may have a different schema than that of the previous serializer. Therefore, when
implementing state serializers, besides the basic logic of reading / writing data, another important thing to keep in
mind is how the serialization schema can be changed in the future.</p>

<p>When speaking of <em>schema</em>, in this context the term is interchangeable between referring to the <em>data model</em> of a state
type and the <em>serialized binary format</em> of a state type. The schema, generally speaking, can change for a few cases:</p>

<ol>
  <li>Data schema of the state type has evolved, i.e. adding or removing a field from a POJO that is used as state.</li>
  <li>Generally speaking, after a change to the data schema, the serialization format of the serializer will need to be upgraded.</li>
  <li>Configuration of the serializer has changed.</li>
</ol>

<p>In order for the new execution to have information about the <em>written schema</em> of state and detect whether or not the
schema has changed, upon taking a savepoint of an operator’s state, a <em>snapshot</em> of the state serializer needs to be
written along with the state bytes. This is abstracted a <code class="highlighter-rouge">TypeSerializerSnapshot</code>, explained in the next subsection.</p>

<h3 id="the-typeserializersnapshot-abstraction">The <code class="highlighter-rouge">TypeSerializerSnapshot</code> abstraction</h3>

<div data-lang="java">

  <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">TypeSerializerSnapshot</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="kt">int</span> <span class="nf">getCurrentVersion</span><span class="o">();</span>
    <span class="kt">void</span> <span class="nf">writeSnapshot</span><span class="o">(</span><span class="n">DataOuputView</span> <span class="n">out</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">;</span>
    <span class="kt">void</span> <span class="nf">readSnapshot</span><span class="o">(</span><span class="kt">int</span> <span class="n">readVersion</span><span class="o">,</span> <span class="n">DataInputView</span> <span class="n">in</span><span class="o">,</span> <span class="n">ClassLoader</span> <span class="n">userCodeClassLoader</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span><span class="o">;</span>
    <span class="n">TypeSerializerSchemaCompatibility</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">resolveSchemaCompatibility</span><span class="o">(</span><span class="n">TypeSerializer</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">newSerializer</span><span class="o">);</span>
    <span class="n">TypeSerializer</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">restoreSerializer</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure>

</div>

<div data-lang="java">

  <figure class="highlight"><pre><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="kd">abstract</span> <span class="kd">class</span> <span class="nc">TypeSerializer</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="o">{</span>    
    
    <span class="c1">// ...</span>
    
    <span class="kd">public</span> <span class="kd">abstract</span> <span class="n">TypeSerializerSnapshot</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="nf">snapshotConfiguration</span><span class="o">();</span>
<span class="o">}</span></code></pre></figure>

</div>

<p>A serializer’s <code class="highlighter-rouge">TypeSerializerSnapshot</code> is a point-in-time information that serves as the single source of truth about
the state serializer’s write schema, as well as any additional information mandatory to restore a serializer that
would be identical to the given point-in-time. The logic about what should be written and read at restore time
as the serializer snapshot is defined in the <code class="highlighter-rouge">writeSnapshot</code> and <code class="highlighter-rouge">readSnapshot</code> methods.</p>

<p>Note that the snapshot’s own write schema may also need to change over time (e.g. when you wish to add more information
about the serializer to the snapshot). To facilitate this, snapshots are versioned, with the current version
number defined in the <code class="highlighter-rouge">getCurrentVersion</code> method. On restore, when the serializer snapshot is read from savepoints,
the version of the schema in which the snapshot was written in will be provided to the <code class="highlighter-rouge">readSnapshot</code> method so that
the read implementation can handle different versions.</p>

<p>At restore time, the logic that detects whether or not the new serializer’s schema has changed should be implemented in
the <code class="highlighter-rouge">resolveSchemaCompatibility</code> method. When previous registered state is registered again with new serializers in the
restored execution of an operator, the new serializer is provided to the previous serializer’s snapshot via this method.
This method returns a <code class="highlighter-rouge">TypeSerializerSchemaCompatibility</code> representing the result of the compatibility resolution,
which can be one of the following:</p>

<ol>
  <li><strong><code class="highlighter-rouge">TypeSerializerSchemaCompatibility.compatibleAsIs()</code></strong>: this result signals that the new serializer is compatible,
 meaning that the new serializer has identical schema with the previous serializer. It is possible that the new
 serializer has been reconfigured in the <code class="highlighter-rouge">resolveSchemaCompatibility</code> method so that it is compatible.</li>
  <li><strong><code class="highlighter-rouge">TypeSerializerSchemaCompatibility.compatibleAfterMigration()</code></strong>: this result signals that the new serializer has a
 different serialization schema, and it is possible to migrate from the old schema by using the previous serializer
 (which recognizes the old schema) to read bytes into state objects, and then rewriting the object back to bytes with
 the new serializer (which recognizes the new schema).</li>
  <li><strong><code class="highlighter-rouge">TypeSerializerSchemaCompatibility.incompatible()</code></strong>: this result signals that the new serializer has a
 different serialization schema, but it is not possible to migrate from the old schema.</li>
</ol>

<p>The last bit of detail is how the previous serializer is obtained in the case that migration is required.
Another important role of a serializer’s <code class="highlighter-rouge">TypeSerializerSnapshot</code> is that it serves as a factory to restore
the previous serializer. More specifically, the <code class="highlighter-rouge">TypeSerializerSnapshot</code> should implement the <code class="highlighter-rouge">restoreSerializer</code> method
to instantiate a serializer instance that recognizes the previous serializer’s schema and configuration, and can therefore
safely read data written by the previous serializer.</p>

<h3 id="how-flink-interacts-with-the-typeserializer-and-typeserializersnapshot-abstractions">How Flink interacts with the <code class="highlighter-rouge">TypeSerializer</code> and <code class="highlighter-rouge">TypeSerializerSnapshot</code> abstractions</h3>

<p>To wrap up, this section concludes how Flink, or more specifically the state backends, interact with the
abstractions. The interaction is slightly different depending on the state backend, but this is orthogonal
to the implementation of state serializers and their serializer snapshots.</p>

<h4 id="off-heap-state-backends-eg-rocksdbstatebackend">Off-heap state backends (e.g. <code class="highlighter-rouge">RocksDBStateBackend</code>)</h4>

<ol>
  <li><strong>Register new state with a state serializer that has schema <em>A</em></strong>
    <ul>
      <li>the registered <code class="highlighter-rouge">TypeSerializer</code> for the state is used to read / write state on every state access.</li>
      <li>State is written in schema <em>A</em>.</li>
    </ul>
  </li>
  <li><strong>Take a savepoint</strong>
    <ul>
      <li>The serializer snapshot is extracted via the <code class="highlighter-rouge">TypeSerializer#snapshotConfiguration</code> method.</li>
      <li>The serializer snapshot is written to the savepoint, as well as the already-serialized state bytes (with schema <em>A</em>).</li>
    </ul>
  </li>
  <li><strong>Restored execution re-accesses restored state bytes with new state serializer that has schema <em>B</em></strong>
    <ul>
      <li>The previous state serializer’s snapshot is restored.</li>
      <li>State bytes are not deserialized on restore, only loaded back to the state backends (therefore, still in schema <em>A</em>).</li>
      <li>Upon receiving the new serializer, it is provided to the restored previous serializer’s snapshot via the
  <code class="highlighter-rouge">TypeSerializer#resolveSchemaCompatibility</code> to check for schema compatibility.</li>
    </ul>
  </li>
  <li><strong>Migrate state bytes in backend from schema <em>A</em> to schema <em>B</em></strong>
    <ul>
      <li>If the compatibility resolution reflects that the schema has changed and migration is possible, schema migration is 
  performed. The previous state serializer which recognizes schema <em>A</em> will be obtained from the serializer snapshot, via
   <code class="highlighter-rouge">TypeSerializerSnapshot#restoreSerializer()</code>, and is used to deserialize state bytes to objects, which in turn
   are re-written again with the new serializer, which recognizes schema <em>B</em> to complete the migration. All entries
   of the accessed state is migrated all-together before processing continues.</li>
      <li>If the resolution signals incompatibility, then the state access fails with an exception.</li>
    </ul>
  </li>
</ol>

<h4 id="heap-state-backends-eg-memorystatebackend-fsstatebackend">Heap state backends (e.g. <code class="highlighter-rouge">MemoryStateBackend</code>, <code class="highlighter-rouge">FsStateBackend</code>)</h4>

<ol>
  <li><strong>Register new state with a state serializer that has schema <em>A</em></strong>
    <ul>
      <li>the registered <code class="highlighter-rouge">TypeSerializer</code> is maintained by the state backend.</li>
    </ul>
  </li>
  <li><strong>Take a savepoint, serializing all state with schema <em>A</em></strong>
    <ul>
      <li>The serializer snapshot is extracted via the <code class="highlighter-rouge">TypeSerializer#snapshotConfiguration</code> method.</li>
      <li>The serializer snapshot is written to the savepoint.</li>
      <li>State objects are now serialized to the savepoint, written in schema <em>A</em>.</li>
    </ul>
  </li>
  <li><strong>On restore, deserialize state into objects in heap</strong>
    <ul>
      <li>The previous state serializer’s snapshot is restored.</li>
      <li>The previous serializer, which recognizes schema <em>A</em>, is obtained from the serializer snapshot, via
  <code class="highlighter-rouge">TypeSerializerSnapshot#restoreSerializer()</code>, and is used to deserialize state bytes to objects.</li>
      <li>From now on, all of the state is already deserialized.</li>
    </ul>
  </li>
  <li><strong>Restored execution re-accesses previous state with new state serializer that has schema <em>B</em></strong>
    <ul>
      <li>Upon receiving the new serializer, it is provided to the restored previous serializer’s snapshot via the
  <code class="highlighter-rouge">TypeSerializer#resolveSchemaCompatibility</code> to check for schema compatibility.</li>
      <li>If the compatibility check signals that migration is required, nothing happens in this case since for
   heap backends, all state is already deserialized into objects.</li>
      <li>If the resolution signals incompatibility, then the state access fails with an exception.</li>
    </ul>
  </li>
  <li><strong>Take another savepoint, serializing all state with schema <em>B</em></strong>
    <ul>
      <li>Same as step 2., but now state bytes are all in schema <em>B</em>.</li>
    </ul>
  </li>
</ol>

<h2 id="implementation-notes-and-best-practices">Implementation notes and best practices</h2>

<h4 id="1-flink-restores-serializer-snapshots-by-instantiating-them-with-their-classname">1. Flink restores serializer snapshots by instantiating them with their classname</h4>

<p>A serializer’s snapshot, being the single source of truth for how a registered state was serialized, serves as an
entry point to reading state in savepoints. In order to be able to restore and access previous state, the previous state
serializer’s snapshot must be able to be restored.</p>

<p>Flink restores serializer snapshots by first instantiating the <code class="highlighter-rouge">TypeSerializerSnapshot</code> with its classname (written
along with the snapshot bytes). Therefore, to avoid being subject to unintended classname changes or instantiation
failures, <code class="highlighter-rouge">TypeSerializerSnapshot</code> classes should:</p>

<ul>
  <li>avoid being implemented as anonymous classes or nested classes,</li>
  <li>have a public, nullary constructor for instantiation</li>
</ul>

<h4 id="2-avoid-sharing-the-same-typeserializersnapshot-class-across-different-serializers">2. Avoid sharing the same <code class="highlighter-rouge">TypeSerializerSnapshot</code> class across different serializers</h4>

<p>Since schema compatibility checks goes through the serializer snapshots, having multiple serializers returning
the same <code class="highlighter-rouge">TypeSerializerSnapshot</code> class as their snapshot would complicate the implementation for the
<code class="highlighter-rouge">TypeSerializerSnapshot#resolveSchemaCompatibility</code> and <code class="highlighter-rouge">TypeSerializerSnapshot#restoreSerializer()</code> method.</p>

<p>This would also be a bad separation of concerns; a single serializer’s serialization schema,
configuration, as well as how to restore it, should be consolidated in its own dedicated <code class="highlighter-rouge">TypeSerializerSnapshot</code> class.</p>

<h4 id="3-use-the-compositeserializersnapshot-utility-for-serializers-that-contain-nested-serializers">3. Use the <code class="highlighter-rouge">CompositeSerializerSnapshot</code> utility for serializers that contain nested serializers</h4>

<p>There may be cases where a <code class="highlighter-rouge">TypeSerializer</code> relies on other nested <code class="highlighter-rouge">TypeSerializer</code>s; take for example Flink’s
<code class="highlighter-rouge">TupleSerializer</code>, where it is configured with nested <code class="highlighter-rouge">TypeSerializer</code>s for the tuple fields. In this case,
the snapshot of the most outer serializer should also contain snapshots of the nested serializers.</p>

<p>The <code class="highlighter-rouge">CompositeSerializerSnapshot</code> can be used specifically for this scenario. It wraps the logic of resolving
the overall schema compatibility check result for the composite serializer.
For an example of how it should be used, one can refer to Flink’s
<a href="https://github.com/apache/flink/blob/master/flink-core/src/main/java/org/apache/flink/api/common/typeutils/base/ListSerializerSnapshot.java">ListSerializerSnapshot</a> implementation.</p>

<h2 id="migrating-from-deprecated-serializer-snapshot-apis-before-flink-17">Migrating from deprecated serializer snapshot APIs before Flink 1.7</h2>

<p>This section is a guide for API migration from serializers and serializer snapshots that existed before Flink 1.7.</p>

<p>Before Flink 1.7, serializer snapshots were implemented as a <code class="highlighter-rouge">TypeSerializerConfigSnapshot</code> (which is now deprecated,
and will eventually be removed in the future to be fully replaced by the new <code class="highlighter-rouge">TypeSerializerSnapshot</code> interface).
Moreover, the responsibility of serializer schema compatibility checks lived within the <code class="highlighter-rouge">TypeSerializer</code>,
implemented in the <code class="highlighter-rouge">TypeSerializer#ensureCompatibility(TypeSerializerConfigSnapshot)</code> method.</p>

<p>Another major difference between the new and old abstractions is that the deprecated <code class="highlighter-rouge">TypeSerializerConfigSnapshot</code>
did not have the capability of instantiating the previous serializer. Therefore, in the case where your serializer
still returns a subclass of <code class="highlighter-rouge">TypeSerializerConfigSnapshot</code> as its snapshot, the serializer instance itself will always
be written to savepoints using Java serialization so that the previous serializer may be available at restore time.
This is very undesirable, since whether or not restoring the job will be successful is susceptible to availability
of the previous serializer’s class, or in general, whether or not the serializer instance can be read back at restore
time using Java serialization. This means that you be limited to the same serializer for your state,
and could be problematic once you want to upgrade serializer classes or perform schema migration.</p>

<p>To be future-proof and have flexibility to migrate your state serializers and schema, it is highly recommended to
migrate from the old abstractions. The steps to do this is as follows:</p>

<ol>
  <li>Implement a new subclass of <code class="highlighter-rouge">TypeSerializerSnapshot</code>. This will be the new snapshot for your serializer.</li>
  <li>Return the new <code class="highlighter-rouge">TypeSerializerSnapshot</code> as the serializer snapshot for your serializer in the
 <code class="highlighter-rouge">TypeSerializer#snapshotConfiguration()</code> method.</li>
  <li>Restore the job from the savepoint that existed before Flink 1.7, and then take a savepoint again.
 Note that at this step, the old <code class="highlighter-rouge">TypeSerializerConfigSnapshot</code> of the serializer must still exist in the classpath,
 and the implementation for the <code class="highlighter-rouge">TypeSerializer#ensureCompatibility(TypeSerializerConfigSnapshot)</code> method must not be
 removed. The purpose of this process is to replace the <code class="highlighter-rouge">TypeSerializerConfigSnapshot</code> written in old savepoints
 with the newly implemented <code class="highlighter-rouge">TypeSerializerSnapshot</code> for the serializer.</li>
  <li>Once you have a savepoint taken with Flink 1.7, the savepoint will contain <code class="highlighter-rouge">TypeSerializerSnapshot</code> as the
 state serializer snapshot, and the serializer instance will no longer be written in the savepoint.
 At this point, it is now safe to remove all implementations of the old abstraction (remove the old
 <code class="highlighter-rouge">TypeSerializerConfigSnapshot</code> implementation as will as the
 <code class="highlighter-rouge">TypeSerializer#ensureCompatibility(TypeSerializerConfigSnapshot)</code> from the serializer).</li>
</ol>

<p><a href="#top" class="top pull-right"><span class="glyphicon glyphicon-chevron-up"></span> Back to top</a></p>


        </div>
      </div>
    </div><!-- /.container -->

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="/page/js/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.1.0/anchor.min.js"></script>
    <script src="/page/js/flink.js"></script>

    <!-- Google Analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-52545728-1', 'auto');
      ga('send', 'pageview');
    </script>

    <!-- Disqus -->
    
  </body>
</html>
